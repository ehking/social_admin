{% extends "base.html" %}
{% block title %}زمان‌بندی محتوا | Social Admin{% endblock %}
{% block page_title %}برنامه‌ریزی انتشار محتوا{% endblock %}
{% block page_subtitle %}پست‌های خود را برای شبکه‌های اجتماعی زمان‌بندی کنید{% endblock %}
{% block content %}
<section class="panel">
    <header class="panel-header">
        <div>
            <h2>ثبت زمان‌بندی جدید</h2>
            <p class="panel-description">یک حساب را انتخاب کنید و محتوا را تنظیم نمایید</p>
        </div>
    </header>
    <form method="post" action="/scheduler" class="form-grid">
        <div class="form-field">
            <label for="account_id">حساب <span class="required-marker" aria-hidden="true">*</span><span class="sr-only">فیلد اجباری</span></label>
            <select name="account_id" id="account_id" required>
                <option value="" disabled selected>یک حساب را انتخاب کنید</option>
                {% for account in accounts %}
                    <option value="{{ account.id }}">{{ account.display_name }} ({{ account.platform }})</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-field">
            <label for="title">عنوان <span class="required-marker" aria-hidden="true">*</span><span class="sr-only">فیلد اجباری</span></label>
            <input type="text" id="title" name="title" required>
        </div>
        <div class="form-field full">
            <label for="content">متن پیام</label>
            <textarea id="content" name="content" rows="4" placeholder="متن اختیاری برای انتشار..."></textarea>
        </div>
        <div class="form-field">
            <label for="video_url">لینک ویدیو</label>
            <input type="url" id="video_url" name="video_url" placeholder="https://...">
        </div>
        <div class="form-field">
            <label for="scheduled_time">تاریخ و زمان اجرا <span class="required-marker" aria-hidden="true">*</span><span class="sr-only">فیلد اجباری</span></label>
            <input type="datetime-local" id="scheduled_time" name="scheduled_time" required>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn">ثبت زمان‌بندی</button>
        </div>
    </form>
</section>
<section class="panel">
    <header class="panel-header">
        <div>
            <h2>پست‌های برنامه‌ریزی شده</h2>
            <p class="panel-description">فهرست کامل پست‌های در انتظار</p>
        </div>
    </header>
    {% if posts %}
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>عنوان</th>
                        <th>حساب</th>
                        <th>زمان اجرا</th>
                        <th>وضعیت</th>
                        <th>لینک ویدیو</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
{% for post in posts %}
                        <tr data-video="{{ post.video_url or '' }}" data-content="{{ post.content or '' }}">
                                <td>{{ post.title }}</td>
                                <td>{{ post.account.display_name if post.account else '-' }}</td>
                                <td>{{ post.scheduled_time.strftime('%Y-%m-%d %H:%M') if post.scheduled_time else '' }}</td>
                                <td><span class="badge badge-secondary">{{ post.status or 'pending' }}</span></td>
                                <td>
                                    {% if post.video_url %}
                                        <a href="{{ post.video_url }}" target="_blank" rel="noopener" class="link">مشاهده</a>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td class="actions">
                                    <form method="post" action="/scheduler/delete" onsubmit="return confirm('زمان‌بندی حذف شود؟');">
                                        <input type="hidden" name="post_id" value="{{ post.id }}">
                                        <button type="submit" class="btn btn-small btn-danger">حذف</button>
                                    </form>
                                </td>
                        </tr>
{% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="empty">هیچ زمان‌بندی فعالی ثبت نشده است.</p>
    {% endif %}
</section>
{% endblock %}
